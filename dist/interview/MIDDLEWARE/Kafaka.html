<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/interview/MIDDLEWARE/Kafaka.html"><meta property="og:site_name" content="Magic.*"><meta property="og:title" content="Kafaka"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-02T11:11:09.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-10-02T18:50:29.000Z"><meta property="article:modified_time" content="2022-10-02T11:11:09.000Z"><title>Kafaka | Magic.*</title><meta name="description" content="vuepress-theme-hope 的文档演示">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.e1db1067.css">
    <link rel="modulepreload" href="/assets/app.c4e9f175.js"><link rel="modulepreload" href="/assets/Kafaka.html.1a4b0422.js"><link rel="modulepreload" href="/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/assets/Kafaka.html.3dfbf378.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="/logo.svg" alt="Magic.*"><!----><span class="site-name hide-in-pad">Magic.*</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home"></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="面向简历编程"><span class="title"><span class="icon iconfont icon-discover"></span>面向简历编程</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>JAVA</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/JAVA/java.html" class="nav-link" aria-label="JAVA基础"><!---->JAVA基础<!----></a></li><li class="dropdown-subitem"><a href="/interview/JAVA/juc.html" class="nav-link" aria-label="JUC编程"><!---->JUC编程<!----></a></li><li class="dropdown-subitem"><a href="/interview/JAVA/jvm.html" class="nav-link" aria-label="JVM基础"><!---->JVM基础<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>数据库</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/DB/MySQL.html" class="nav-link" aria-label="MySQL"><!---->MySQL<!----></a></li><li class="dropdown-subitem"><a href="/interview/DB/Redis.html" class="nav-link" aria-label="Redis"><!---->Redis<!----></a></li><li class="dropdown-subitem"><a href="/interview/DB/MongoDB.html" class="nav-link" aria-label="MongoDB"><!---->MongoDB<!----></a></li><li class="dropdown-subitem"><a href="/interview/DB/Elasticsearch.html" class="nav-link" aria-label="Elasticsearch"><!---->Elasticsearch<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>框架</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/FRAMEWORK/Spring.html" class="nav-link" aria-label="Spring"><!---->Spring<!----></a></li><li class="dropdown-subitem"><a href="/interview/FRAMEWORK/SpringMVC.html" class="nav-link" aria-label="SpringMVC"><!---->SpringMVC<!----></a></li><li class="dropdown-subitem"><a href="/interview/FRAMEWORK/SpringBoot.html" class="nav-link" aria-label="SpringBoot"><!---->SpringBoot<!----></a></li><li class="dropdown-subitem"><a href="/interview/FRAMEWORK/SpringCloud.html" class="nav-link" aria-label="SpringCloud"><!---->SpringCloud<!----></a></li><li class="dropdown-subitem"><a href="/interview/FRAMEWORK/MyBatis.html" class="nav-link" aria-label="MyBatis"><!---->MyBatis<!----></a></li><li class="dropdown-subitem"><a href="/interview/FRAMEWORK/Dubbo.html" class="nav-link" aria-label="Dubbo"><!---->Dubbo<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>中间件</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/MIDDLEWARE/MQ_BASE.html" class="nav-link" aria-label="消息队列基础"><!---->消息队列基础<!----></a></li><li class="dropdown-subitem"><a href="/interview/MIDDLEWARE/RabbitMQ.html" class="nav-link" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a></li><li class="dropdown-subitem"><a href="/interview/MIDDLEWARE/RocketMQ.html" class="nav-link" aria-label="RocketMQ"><!---->RocketMQ<!----></a></li><li class="dropdown-subitem"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html" class="router-link-active router-link-exact-active nav-link active" aria-label="Kafaka"><!---->Kafaka<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>优化</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/interview/OPTIMIZE/SQL_OPT.html" class="nav-link" aria-label="SQL优化"><!---->SQL优化<!----></a></li><li class="dropdown-subitem"><a href="/interview/OPTIMIZE/CODE_OPT.html" class="nav-link" aria-label="代码优化"><!---->代码优化<!----></a></li><li class="dropdown-subitem"><a href="/interview/OPTIMIZE/JVM_OPT.html" class="nav-link" aria-label="JVM优化"><!---->JVM优化<!----></a></li><li class="dropdown-subitem"><a href="/interview/OPTIMIZE/TOMCAT_OPT.html" class="nav-link" aria-label="TOMCAT优化"><!---->TOMCAT优化<!----></a></li><li class="dropdown-subitem"><a href="/interview/OPTIMIZE/DATABASE_OPT.html" class="nav-link" aria-label="数据库优化"><!---->数据库优化<!----></a></li><li class="dropdown-subitem"><a href="/interview/OPTIMIZE/INTERFACE_OPT.html" class="nav-link" aria-label="接口性能优化"><!---->接口性能优化<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="数据库"><span class="title"><span class="icon iconfont icon-creative"></span>数据库</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/bar/baz" class="nav-link" aria-label="/db/bar/baz"><!---->/db/bar/baz<!----></a></li><li class="dropdown-subitem"><a href="/db/bar/" class="nav-link" aria-label="..."><!---->...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/db/foo/ray" class="nav-link" aria-label="/db/foo/ray"><!---->/db/foo/ray<!----></a></li><li class="dropdown-subitem"><a href="/db/foo/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="分布式"><span class="title"><span class="icon iconfont icon-creative"></span>分布式</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/distributed/bar/baz" class="nav-link" aria-label="/distributed/bar/baz"><!---->/distributed/bar/baz<!----></a></li><li class="dropdown-subitem"><a href="/distributed/bar/" class="nav-link" aria-label="..."><!---->...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/distributed/foo/ray" class="nav-link" aria-label="/distributed/foo/ray"><!---->/distributed/foo/ray<!----></a></li><li class="dropdown-subitem"><a href="/distributed/foo/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="源码解析"><span class="title"><span class="icon iconfont icon-creative"></span>源码解析</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/sourcecode/bar/baz" class="nav-link" aria-label="/sourcecode/bar/baz"><!---->/sourcecode/bar/baz<!----></a></li><li class="dropdown-subitem"><a href="/sourcecode/bar/" class="nav-link" aria-label="..."><!---->...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/sourcecode/foo/ray" class="nav-link" aria-label="/sourcecode/foo/ray"><!---->/sourcecode/foo/ray<!----></a></li><li class="dropdown-subitem"><a href="/sourcecode/foo/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="小技巧"><span class="title"><span class="icon iconfont icon-creative"></span>小技巧</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/bar/baz.html" class="nav-link" aria-label="Baz"><span class="icon iconfont icon-info"></span>Baz<!----></a></li><li class="dropdown-subitem"><a href="/guide/bar/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/foo/ray.html" class="nav-link" aria-label="Ray"><span class="icon iconfont icon-config"></span>Ray<!----></a></li><li class="dropdown-subitem"><a href="/guide/foo/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="收藏夹"><span class="title"><span class="icon iconfont icon-creative"></span>收藏夹</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Bar</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/bar/baz.html" class="nav-link" aria-label="Baz"><span class="icon iconfont icon-info"></span>Baz<!----></a></li><li class="dropdown-subitem"><a href="/guide/bar/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>Foo</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/guide/foo/ray.html" class="nav-link" aria-label="Ray"><span class="icon iconfont icon-config"></span>Ray<!----></a></li><li class="dropdown-subitem"><a href="/guide/foo/" class="nav-link" aria-label="..."><span class="icon iconfont icon-more"></span>...<!----></a></li></ul></li></ul></button></div></div></nav><!----></div><div class="navbar-right"><!----><!----><!----><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">Java</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">数据库</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">框架</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable active"><!----><span class="title">中间件</span><span class="arrow down"></span></button><ul class="sidebar-links"><li><!--[--><a href="/interview/MIDDLEWARE/MQ_BASE.html" class="nav-link sidebar-link sidebar-page" aria-label="消息队列基础"><!---->消息队列基础<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/interview/MIDDLEWARE/RabbitMQ.html" class="nav-link sidebar-link sidebar-page" aria-label="RabbitMQ"><!---->RabbitMQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/interview/MIDDLEWARE/RocketMQ.html" class="nav-link sidebar-link sidebar-page" aria-label="RocketMQ"><!---->RocketMQ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="Kafaka"><!---->Kafaka<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-1什么是kafka" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1什么是Kafka？"><!---->1.1什么是Kafka？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-2kafka中有哪几个组件" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2Kafka中有哪几个组件?"><!---->1.2Kafka中有哪几个组件?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-3什么是消费者或用户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.3什么是消费者或用户？"><!---->1.3什么是消费者或用户？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-4kafka中的-broker-是干什么的" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.4Kafka中的 Broker 是干什么的？"><!---->1.4Kafka中的 Broker 是干什么的？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-5什么是生产者" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.5什么是生产者？"><!---->1.5什么是生产者？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-6什么是消费者组" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.6什么是消费者组？"><!---->1.6什么是消费者组？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-7偏移的作用是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.7偏移的作用是什么？"><!---->1.7偏移的作用是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-8kafka系统工具有哪些类型" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.8Kafka系统工具有哪些类型？"><!---->1.8Kafka系统工具有哪些类型？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-9kafka为什么那么快" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.9Kafka为什么那么快?"><!---->1.9Kafka为什么那么快?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-10kafka的message格式是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.10Kafka的message格式是什么？"><!---->1.10Kafka的message格式是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-11kafka可以接收的消息最大为多少" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.11Kafka可以接收的消息最大为多少？"><!---->1.11Kafka可以接收的消息最大为多少？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-12kafka的优点有那些" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.12Kafka的优点有那些？"><!---->1.12Kafka的优点有那些？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-13为什么要使用-kafka-为什么要使用消息队列" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.13为什么要使用 Kafka？为什么要使用消息队列？"><!---->1.13为什么要使用 Kafka？为什么要使用消息队列？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-14kafka存在那些局限性" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.14Kafka存在那些局限性？"><!---->1.14Kafka存在那些局限性？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-15leader和follower的概念是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.15Leader和Follower的概念是什么？"><!---->1.15Leader和Follower的概念是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-16为什么要使用apache-kafka集群" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.16为什么要使用Apache Kafka集群？"><!---->1.16为什么要使用Apache Kafka集群？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-17kafka集群中保留期的目的是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.17Kafka集群中保留期的目的是什么？"><!---->1.17Kafka集群中保留期的目的是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-18kafka和flume之间的主要区别是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.18Kafka和Flume之间的主要区别是什么？"><!---->1.18Kafka和Flume之间的主要区别是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-19apache-kafka是分布式流处理平台吗-如果是-你能用它做什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.19Apache Kafka是分布式流处理平台吗？如果是，你能用它做什么？"><!---->1.19Apache Kafka是分布式流处理平台吗？如果是，你能用它做什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-20流api的作用是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.20流API的作用是什么？"><!---->1.20流API的作用是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-21消费者api的作用是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.21消费者API的作用是什么？"><!---->1.21消费者API的作用是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-22连接器api的作用是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.22连接器API的作用是什么？"><!---->1.22连接器API的作用是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-23kafka中的-zookeeper-起到什么作用-可以不用zookeeper吗" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.23Kafka中的 zookeeper 起到什么作用？可以不用zookeeper吗？"><!---->1.23Kafka中的 zookeeper 起到什么作用？可以不用zookeeper吗？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-24没有zookeeper可以使用kafka吗" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.24没有zookeeper可以使用Kafka吗？"><!---->1.24没有zookeeper可以使用Kafka吗？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-25kafka中的-isr、ar-又代表什么-isr-的伸缩又指什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.25Kafka中的 ISR、AR 又代表什么？ISR 的伸缩又指什么？"><!---->1.25Kafka中的 ISR、AR 又代表什么？ISR 的伸缩又指什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-26副本和-isr-扮演什么角色" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.26副本和 ISR 扮演什么角色？"><!---->1.26副本和 ISR 扮演什么角色？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-27kafka-follower如何与leader同步数据" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.27Kafka Follower如何与Leader同步数据?"><!---->1.27Kafka Follower如何与Leader同步数据?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-28为什么kafka的复制至关重要" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.28为什么Kafka的复制至关重要？"><!---->1.28为什么Kafka的复制至关重要？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-29什么是kafka中的地域复制" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.29什么是Kafka中的地域复制？"><!---->1.29什么是Kafka中的地域复制？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-30什么是多租户" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.30什么是多租户？"><!---->1.30什么是多租户？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-31什么情况下一个-broker-会从isr中踢出去" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.31什么情况下一个 Broker 会从ISR中踢出去?"><!---->1.31什么情况下一个 Broker 会从ISR中踢出去?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-32如果-leader-crash-时-isr为空怎么办" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.32如果 Leader Crash 时，ISR为空怎么办"><!---->1.32如果 Leader Crash 时，ISR为空怎么办<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-33副本长时间不在isr中-这意味着什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.33副本长时间不在ISR中，这意味着什么？"><!---->1.33副本长时间不在ISR中，这意味着什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-34kafka-producer如何优化写入速度" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.34Kafka Producer如何优化写入速度?"><!---->1.34Kafka Producer如何优化写入速度?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-35kafka-producer-api的作用是什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.35Kafka Producer API的作用是什么？"><!---->1.35Kafka Producer API的作用是什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-36生产者中-什么情况下会发生-queuefullexception" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.36生产者中，什么情况下会发生 QueueFullException？"><!---->1.36生产者中，什么情况下会发生 QueueFullException？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-37kafka-producer-写数据-ack-为-0-1-1-时分别代表什么" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.37Kafka Producer 写数据，ACK 为 0，1，-1 时分别代表什么？"><!---->1.37Kafka Producer 写数据，ACK 为 0，1，-1 时分别代表什么？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-38当ack为-1时-什么情况下-leader-认为一条消息-commit了" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.38当ack为-1时，什么情况下，Leader 认为一条消息 Commit了？"><!---->1.38当ack为-1时，什么情况下，Leader 认为一条消息 Commit了？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-39kafka-unclean-配置代表什么-会对-spark-streaming-消费有什么影响" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.39Kafka Unclean 配置代表什么？会对 spark streaming 消费有什么影响？"><!---->1.39Kafka Unclean 配置代表什么？会对 spark streaming 消费有什么影响？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-40kafka-中-consumer-group-是什么概念" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.40Kafka 中 Consumer Group 是什么概念？"><!---->1.40Kafka 中 Consumer Group 是什么概念？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-41kafka-中的消息是否会丢失和重复消费" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.41Kafka 中的消息是否会丢失和重复消费？"><!---->1.41Kafka 中的消息是否会丢失和重复消费？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-42为什么kafka不支持读写分离" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.42为什么Kafka不支持读写分离？"><!---->1.42为什么Kafka不支持读写分离？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-43kafka-中是怎么体现消息顺序性的" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.43Kafka 中是怎么体现消息顺序性的？"><!---->1.43Kafka 中是怎么体现消息顺序性的？<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset-1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset+1?"><!---->1.44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset+1?<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-45kafka-如何实现延迟队列" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.45Kafka 如何实现延迟队列?"><!---->1.45Kafka 如何实现延迟队列?<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><!----><span class="title">优化</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Kafaka</h1><div class="page-info"><span class="author-info" aria-label="作者🖊" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://mrhope.site" target="_blank" rel="noopener noreferrer">Mr.yue</a></span><span property="author" content="Mr.yue"></span></span><!----><span class="date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年10月3日</span><meta property="datePublished" content="2022-10-02T18:50:29.000Z"></span><!----><!----><span class="reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-1什么是kafka" class="router-link-active router-link-exact-active toc-link level3">1.1什么是Kafka？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-2kafka中有哪几个组件" class="router-link-active router-link-exact-active toc-link level3">1.2Kafka中有哪几个组件?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-3什么是消费者或用户" class="router-link-active router-link-exact-active toc-link level3">1.3什么是消费者或用户？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-4kafka中的-broker-是干什么的" class="router-link-active router-link-exact-active toc-link level3">1.4Kafka中的 Broker 是干什么的？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-5什么是生产者" class="router-link-active router-link-exact-active toc-link level3">1.5什么是生产者？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-6什么是消费者组" class="router-link-active router-link-exact-active toc-link level3">1.6什么是消费者组？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-7偏移的作用是什么" class="router-link-active router-link-exact-active toc-link level3">1.7偏移的作用是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-8kafka系统工具有哪些类型" class="router-link-active router-link-exact-active toc-link level3">1.8Kafka系统工具有哪些类型？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-9kafka为什么那么快" class="router-link-active router-link-exact-active toc-link level3">1.9Kafka为什么那么快?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-10kafka的message格式是什么" class="router-link-active router-link-exact-active toc-link level3">1.10Kafka的message格式是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-11kafka可以接收的消息最大为多少" class="router-link-active router-link-exact-active toc-link level3">1.11Kafka可以接收的消息最大为多少？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-12kafka的优点有那些" class="router-link-active router-link-exact-active toc-link level3">1.12Kafka的优点有那些？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-13为什么要使用-kafka-为什么要使用消息队列" class="router-link-active router-link-exact-active toc-link level3">1.13为什么要使用 Kafka？为什么要使用消息队列？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-14kafka存在那些局限性" class="router-link-active router-link-exact-active toc-link level3">1.14Kafka存在那些局限性？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-15leader和follower的概念是什么" class="router-link-active router-link-exact-active toc-link level3">1.15Leader和Follower的概念是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-16为什么要使用apache-kafka集群" class="router-link-active router-link-exact-active toc-link level3">1.16为什么要使用Apache Kafka集群？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-17kafka集群中保留期的目的是什么" class="router-link-active router-link-exact-active toc-link level3">1.17Kafka集群中保留期的目的是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-18kafka和flume之间的主要区别是什么" class="router-link-active router-link-exact-active toc-link level3">1.18Kafka和Flume之间的主要区别是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-19apache-kafka是分布式流处理平台吗-如果是-你能用它做什么" class="router-link-active router-link-exact-active toc-link level3">1.19Apache Kafka是分布式流处理平台吗？如果是，你能用它做什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-20流api的作用是什么" class="router-link-active router-link-exact-active toc-link level3">1.20流API的作用是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-21消费者api的作用是什么" class="router-link-active router-link-exact-active toc-link level3">1.21消费者API的作用是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-22连接器api的作用是什么" class="router-link-active router-link-exact-active toc-link level3">1.22连接器API的作用是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-23kafka中的-zookeeper-起到什么作用-可以不用zookeeper吗" class="router-link-active router-link-exact-active toc-link level3">1.23Kafka中的 zookeeper 起到什么作用？可以不用zookeeper吗？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-24没有zookeeper可以使用kafka吗" class="router-link-active router-link-exact-active toc-link level3">1.24没有zookeeper可以使用Kafka吗？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-25kafka中的-isr、ar-又代表什么-isr-的伸缩又指什么" class="router-link-active router-link-exact-active toc-link level3">1.25Kafka中的 ISR、AR 又代表什么？ISR 的伸缩又指什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-26副本和-isr-扮演什么角色" class="router-link-active router-link-exact-active toc-link level3">1.26副本和 ISR 扮演什么角色？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-27kafka-follower如何与leader同步数据" class="router-link-active router-link-exact-active toc-link level3">1.27Kafka Follower如何与Leader同步数据?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-28为什么kafka的复制至关重要" class="router-link-active router-link-exact-active toc-link level3">1.28为什么Kafka的复制至关重要？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-29什么是kafka中的地域复制" class="router-link-active router-link-exact-active toc-link level3">1.29什么是Kafka中的地域复制？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-30什么是多租户" class="router-link-active router-link-exact-active toc-link level3">1.30什么是多租户？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-31什么情况下一个-broker-会从isr中踢出去" class="router-link-active router-link-exact-active toc-link level3">1.31什么情况下一个 Broker 会从ISR中踢出去?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-32如果-leader-crash-时-isr为空怎么办" class="router-link-active router-link-exact-active toc-link level3">1.32如果 Leader Crash 时，ISR为空怎么办</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-33副本长时间不在isr中-这意味着什么" class="router-link-active router-link-exact-active toc-link level3">1.33副本长时间不在ISR中，这意味着什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-34kafka-producer如何优化写入速度" class="router-link-active router-link-exact-active toc-link level3">1.34Kafka Producer如何优化写入速度?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-35kafka-producer-api的作用是什么" class="router-link-active router-link-exact-active toc-link level3">1.35Kafka Producer API的作用是什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-36生产者中-什么情况下会发生-queuefullexception" class="router-link-active router-link-exact-active toc-link level3">1.36生产者中，什么情况下会发生 QueueFullException？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-37kafka-producer-写数据-ack-为-0-1-1-时分别代表什么" class="router-link-active router-link-exact-active toc-link level3">1.37Kafka Producer 写数据，ACK 为 0，1，-1 时分别代表什么？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-38当ack为-1时-什么情况下-leader-认为一条消息-commit了" class="router-link-active router-link-exact-active toc-link level3">1.38当ack为-1时，什么情况下，Leader 认为一条消息 Commit了？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-39kafka-unclean-配置代表什么-会对-spark-streaming-消费有什么影响" class="router-link-active router-link-exact-active toc-link level3">1.39Kafka Unclean 配置代表什么？会对 spark streaming 消费有什么影响？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-40kafka-中-consumer-group-是什么概念" class="router-link-active router-link-exact-active toc-link level3">1.40Kafka 中 Consumer Group 是什么概念？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-41kafka-中的消息是否会丢失和重复消费" class="router-link-active router-link-exact-active toc-link level3">1.41Kafka 中的消息是否会丢失和重复消费？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-42为什么kafka不支持读写分离" class="router-link-active router-link-exact-active toc-link level3">1.42为什么Kafka不支持读写分离？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-43kafka-中是怎么体现消息顺序性的" class="router-link-active router-link-exact-active toc-link level3">1.43Kafka 中是怎么体现消息顺序性的？</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset-1" class="router-link-active router-link-exact-active toc-link level3">1.44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset+1?</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/interview/MIDDLEWARE/Kafaka.html#_1-45kafka-如何实现延迟队列" class="router-link-active router-link-exact-active toc-link level3">1.45Kafka 如何实现延迟队列?</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h3 id="_1-1什么是kafka" tabindex="-1"><a class="header-anchor" href="#_1-1什么是kafka" aria-hidden="true">#</a> 1.1什么是Kafka？</h3><p>Kafka是<strong>分布式发布-订阅消息系统</strong>，它最初是由LinkedIn公司开发的，之后成为Apache项目的一部分，Kafka是一个分布式，可划分的，冗余备份的持久性的日志服务，它主要用于处理流式数据。</p><h3 id="_1-2kafka中有哪几个组件" tabindex="-1"><a class="header-anchor" href="#_1-2kafka中有哪几个组件" aria-hidden="true">#</a> 1.2Kafka中有哪几个组件?</h3><ul><li><strong>主题</strong>(Topic)： Kafka主题是一堆或一组消息。</li><li><strong>生产者</strong>(Producer)： 在Kafka，生产者发布通信以及向Kafka主题发布消息。</li><li><strong>消费者</strong>(Consumer)： Kafka消费者订阅了一个主题，并且还从主题中读取和处理消息。</li><li><strong>经纪人</strong>(Brokers)： 在管理主题中的消息存储时，我们使用Kafka Brokers。</li></ul><h3 id="_1-3什么是消费者或用户" tabindex="-1"><a class="header-anchor" href="#_1-3什么是消费者或用户" aria-hidden="true">#</a> 1.3什么是消费者或用户？</h3><p>Kafka消费者订阅一个主题，并读取和处理来自该主题的消息。此外，有了消费者组的名字，消费者就给自己贴上了标签。换句话说，在每个订阅使用者组中，发布到主题的每个记录都传递到一个使用者实例。确保使用者实例可能位于单独的进程或单独的计算机上。</p><h3 id="_1-4kafka中的-broker-是干什么的" tabindex="-1"><a class="header-anchor" href="#_1-4kafka中的-broker-是干什么的" aria-hidden="true">#</a> 1.4Kafka中的 Broker 是干什么的？</h3><p>broker 是消息的代理，Producers往Brokers里面的指定Topic中写消息，Consumers从Brokers里面拉取指定Topic的消息，然后进行业务处理，broker在中间起到一个代理保存消息的中转站。</p><h3 id="_1-5什么是生产者" tabindex="-1"><a class="header-anchor" href="#_1-5什么是生产者" aria-hidden="true">#</a> 1.5什么是生产者？</h3><p>生产者的主要作用是将数据发布到他们选择的主题上。基本上，它的职责是选择要分配给主题内分区的记录。</p><h3 id="_1-6什么是消费者组" tabindex="-1"><a class="header-anchor" href="#_1-6什么是消费者组" aria-hidden="true">#</a> 1.6什么是消费者组？</h3><p>消费者组的概念是Apache Kafka独有的。基本上，每个Kafka消费群体都由一个或多个共同消费一组订阅主题的消费者组成。</p><h3 id="_1-7偏移的作用是什么" tabindex="-1"><a class="header-anchor" href="#_1-7偏移的作用是什么" aria-hidden="true">#</a> 1.7偏移的作用是什么？</h3><p>给分区中的消息提供了一个顺序ID号，我们称之为偏移量。因此，为了唯一地识别分区中的每条消息，我们使用这些偏移量。</p><h3 id="_1-8kafka系统工具有哪些类型" tabindex="-1"><a class="header-anchor" href="#_1-8kafka系统工具有哪些类型" aria-hidden="true">#</a> 1.8Kafka系统工具有哪些类型？</h3><ol><li><strong>Kafka迁移工具</strong>：它有助于将代理从一个版本迁移到另一个版本。</li><li><strong>Mirror Maker</strong>：Mirror Maker工具有助于将一个Kafka集群的镜像提供给另一个。</li><li><strong>消费者检查</strong>:对于指定的主题集和消费者组，它显示主题，分区，所有者。</li></ol><h3 id="_1-9kafka为什么那么快" tabindex="-1"><a class="header-anchor" href="#_1-9kafka为什么那么快" aria-hidden="true">#</a> 1.9Kafka为什么那么快?</h3><ul><li>Cache Filesystem Cache PageCache缓存</li><li>顺序写 由于现代的操作系统提供了预读和写技术，磁盘的顺序写大多数情况下比随机写内存还要快。</li><li>Zero-copy 零拷技术减少拷贝次数</li><li>Batching of Messages 批量量处理。合并小的请求，然后以流的方式进行交互，直顶网络上限。</li><li>Pull 拉模式 使用拉模式进行消息的获取消费，与消费端处理能力相符。</li></ul><h3 id="_1-10kafka的message格式是什么" tabindex="-1"><a class="header-anchor" href="#_1-10kafka的message格式是什么" aria-hidden="true">#</a> 1.10Kafka的message格式是什么？</h3><p>一个Kafka的Message由一个<strong>固定长度的header</strong>和一个<strong>变长的消息体body</strong>组成</p><ul><li>header部分 由一个字节的magic(文件格式)和四个字节的CRC32(用于判断body消息体是否正常)构成。 <ul><li>当magic的值为1的时候，会在magic和crc32之间多一个字节的数据：attributes(保存一些相关属性，比如是否压缩、压缩格式等等);</li><li>如果magic的值为0，那么不存在attributes属性</li></ul></li><li>body部分 由N个字节构成的一个消息体，包含了具体的key/value消息</li></ul><h3 id="_1-11kafka可以接收的消息最大为多少" tabindex="-1"><a class="header-anchor" href="#_1-11kafka可以接收的消息最大为多少" aria-hidden="true">#</a> 1.11Kafka可以接收的消息最大为多少？</h3><p>Kafka可以接收的最大消息大小约为1000000字节。</p><h3 id="_1-12kafka的优点有那些" tabindex="-1"><a class="header-anchor" href="#_1-12kafka的优点有那些" aria-hidden="true">#</a> 1.12Kafka的优点有那些？</h3><ul><li><strong>高吞吐量</strong>：我们在Kafka中不需要任何大型硬件，因为它能够处理高速和大容量数据。此外，它还可以支持每秒数千条消息的消息吞吐量。</li><li><strong>低延迟</strong>：Kafka可以轻松处理这些消息，具有毫秒级的极低延迟，这是大多数新用例所要求的。</li><li><strong>容错</strong>：Kafka能够抵抗集群中的节点/机器故障。</li><li><strong>耐久性</strong>：由于Kafka支持消息复制，因此消息永远不会丢失。这是耐久性背后的原因之一。</li><li><strong>可扩展性</strong>：Kafka可以扩展，而不需要通过添加额外的节点而在运行中造成任何停机。</li></ul><h3 id="_1-13为什么要使用-kafka-为什么要使用消息队列" tabindex="-1"><a class="header-anchor" href="#_1-13为什么要使用-kafka-为什么要使用消息队列" aria-hidden="true">#</a> 1.13为什么要使用 Kafka？为什么要使用消息队列？</h3><ul><li><strong>缓冲和削峰</strong>： 上游数据时有突发流量，下游可能扛不住，或者下游没有足够多的机器来保证冗余，kafka在中间可以起到一个缓冲的作用，把消息暂存在kafka中，下游服务就可以按照自己的节奏进行慢慢处理。</li><li><strong>解耦和扩展性</strong>： 项目开始的时候，并不能确定具体需求。消息队列可以作为一个接口层，解耦重要的业务流程。只需要遵守约定，针对数据编程即可获取扩展能力。</li><li><strong>冗余</strong>： 可以采用一对多的方式，一个生产者发布消息，可以被多个订阅topic的服务消费到，供多个毫无关联的业务使用。</li><li><strong>健壮性</strong>： 消息队列可以堆积请求，所以消费端业务即使短时间死掉，也不会影响主要业务的正常进行。</li><li><strong>异步通信</strong>： 很多时候，用户不想也不需要立即处理消息。消息队列提供了异步处理机制，允许用户把一个消息放入队列，但并不立即处理它。想向队列中放入多少消息就放多少，然后在需要的时候再去处理它们。</li></ul><h3 id="_1-14kafka存在那些局限性" tabindex="-1"><a class="header-anchor" href="#_1-14kafka存在那些局限性" aria-hidden="true">#</a> 1.14Kafka存在那些局限性？</h3><ol><li>没有完整的监控工具集</li><li>消息调整的问题</li><li>不支持通配符主题选择</li><li>速度问题</li></ol><h3 id="_1-15leader和follower的概念是什么" tabindex="-1"><a class="header-anchor" href="#_1-15leader和follower的概念是什么" aria-hidden="true">#</a> 1.15Leader和Follower的概念是什么？</h3><p>在Kafka的每个分区中，都有一个服务器充当leader，0到多个服务器充当follower的角色。</p><h3 id="_1-16为什么要使用apache-kafka集群" tabindex="-1"><a class="header-anchor" href="#_1-16为什么要使用apache-kafka集群" aria-hidden="true">#</a> 1.16为什么要使用Apache Kafka集群？</h3><p>为了克服收集大量数据和分析收集数据的挑战，我们需要一个消息队列系统。因此Apache Kafka应运而生。其好处是：只需存储/发送事件以进行实时处理，就可以跟踪Web活动。通过这一点，我们可以发出警报并报告操作指标。此外，我们可以将数据转换为标准格式。此外，它允许对主题的流数据进行连续处理。由于它的广泛使用，它秒杀了竞品，如ActiveMQ，RabbitMQ等。</p><h3 id="_1-17kafka集群中保留期的目的是什么" tabindex="-1"><a class="header-anchor" href="#_1-17kafka集群中保留期的目的是什么" aria-hidden="true">#</a> 1.17Kafka集群中保留期的目的是什么？</h3><p>保留期限保留了Kafka群集中的所有已发布记录。它不会检查它们是否已被消耗。此外，可以通过使用保留期的配置设置来丢弃记录。而且，它可以释放一些空间。</p><h3 id="_1-18kafka和flume之间的主要区别是什么" tabindex="-1"><a class="header-anchor" href="#_1-18kafka和flume之间的主要区别是什么" aria-hidden="true">#</a> 1.18Kafka和Flume之间的主要区别是什么？</h3><ul><li>工具类型 <ul><li>Apache Kafka 是面向多个生产商和消费者的通用工具。</li><li>Apache Flume 是特定应用程序的专用工具。</li></ul></li><li>复制功能 <ul><li>Apache Kafka 可以复制事件；</li><li>Apache Flume 不复制事件。</li></ul></li></ul><h3 id="_1-19apache-kafka是分布式流处理平台吗-如果是-你能用它做什么" tabindex="-1"><a class="header-anchor" href="#_1-19apache-kafka是分布式流处理平台吗-如果是-你能用它做什么" aria-hidden="true">#</a> 1.19Apache Kafka是分布式流处理平台吗？如果是，你能用它做什么？</h3><p>Kafka是一个流处理平台。它可以完成以下工作：</p><ol><li>轻松推送记录</li><li>可以存储大量记录，而不会出现任何存储问题</li><li>它还可以在记录进入时对其进行处理。</li></ol><h3 id="_1-20流api的作用是什么" tabindex="-1"><a class="header-anchor" href="#_1-20流api的作用是什么" aria-hidden="true">#</a> 1.20流API的作用是什么？</h3><p>一种允许应用程序充当流处理器的API，它还使用一个或多个主题的输入流，并生成一个输出流到一个或多个输出主题，此外，有效地将输入流转换为输出流，我们称之为流API。</p><h3 id="_1-21消费者api的作用是什么" tabindex="-1"><a class="header-anchor" href="#_1-21消费者api的作用是什么" aria-hidden="true">#</a> 1.21消费者API的作用是什么？</h3><p>允许应用程序订阅一个或多个主题并处理生成给它们的记录流的API，我们称之为消费者API。</p><h3 id="_1-22连接器api的作用是什么" tabindex="-1"><a class="header-anchor" href="#_1-22连接器api的作用是什么" aria-hidden="true">#</a> 1.22连接器API的作用是什么？</h3><p>一个允许运行和构建可重用的生产者或消费者的API，将Kafka主题连接到现有的应用程序或数据系统，我们称之为连接器API。</p><h3 id="_1-23kafka中的-zookeeper-起到什么作用-可以不用zookeeper吗" tabindex="-1"><a class="header-anchor" href="#_1-23kafka中的-zookeeper-起到什么作用-可以不用zookeeper吗" aria-hidden="true">#</a> 1.23Kafka中的 zookeeper 起到什么作用？可以不用zookeeper吗？</h3><p>zookeeper 是一个分布式的协调组件，早期版本的kafka用zk做meta信息存储，consumer的消费状态，group 的管理以及 offset 的值。考虑到 zookeeper 本身的一些因素以及整个架构较大概率存在单点问题，新版本中逐渐弱化了 zookeeper 的作用。新的 consumer 使用了 kafka 内部的 group coordination 协议，也减少了对 zookeeper 的依赖，</p><p>但是 broker 依然依赖于 zookeeper，zookeeper 在kafka中还用来选举 controller 和检测 broker 是否存活等等。</p><h3 id="_1-24没有zookeeper可以使用kafka吗" tabindex="-1"><a class="header-anchor" href="#_1-24没有zookeeper可以使用kafka吗" aria-hidden="true">#</a> 1.24没有zookeeper可以使用Kafka吗？</h3><p>绕过Zookeeper并直接连接到Kafka服务器是不可以的，所以答案是否定的。如果以某种方式，使ZooKeeper关闭，则无法为任何客户端请求提供服务。</p><h3 id="_1-25kafka中的-isr、ar-又代表什么-isr-的伸缩又指什么" tabindex="-1"><a class="header-anchor" href="#_1-25kafka中的-isr、ar-又代表什么-isr-的伸缩又指什么" aria-hidden="true">#</a> 1.25Kafka中的 ISR、AR 又代表什么？ISR 的伸缩又指什么？</h3><ul><li><strong>ISR</strong>：In-Sync Replicas 副本同步队列； ISR是由leader维护，follower从leader同步数据有一些延迟（包括延迟时间replica.lag.time.max.ms和延迟条数replica.lag.max.messages两个维度, 版本0.10.x中只支持replica.lag.time.max.ms这个维度），任意一个超过阈值都会把follower剔除出ISR, 存入OSR（Outof-Sync Replicas）列表，新加入的follower也会先存放在OSR中。AR=ISR+OSR。</li><li><strong>AR</strong>：Assigned Replicas 所有副本；</li></ul><h3 id="_1-26副本和-isr-扮演什么角色" tabindex="-1"><a class="header-anchor" href="#_1-26副本和-isr-扮演什么角色" aria-hidden="true">#</a> 1.26副本和 ISR 扮演什么角色？</h3><p>基本上，复制日志的节点列表就是副本。特别是对于特定的分区。但是，无论他们是否扮演leader的角色，他们都是如此。此外，ISR指的是同步副本。在定义ISR时，它是一组与leader同步的消息副本。</p><h3 id="_1-27kafka-follower如何与leader同步数据" tabindex="-1"><a class="header-anchor" href="#_1-27kafka-follower如何与leader同步数据" aria-hidden="true">#</a> 1.27Kafka Follower如何与Leader同步数据?</h3><p>Kafka 的复制机制既不是完全的同步复制，也不是单纯的异步复制。完全同步复制要求 All Alive Follower 都复制完，这条消息才会被认为 commit，这种复制方式极大的影响了吞吐率。而异步复制方式下，Follower 异步的从 Leader 复制数据，数据只要被 Leader 写入 log 就被认为已经 commit，这种情况下，如果 leader 挂掉，会丢失数据，kafka 使用 ISR 的方式很好的均衡了确保数据不丢失以及吞吐率。Follower 可以批量的从 Leader 复制数据，而且 Leader 充分利用磁盘顺序读以及 send file(zero copy) 机制，这样极大的提高复制性能，内部批量写磁盘，大幅减少了 Follower 与 Leader 的消息量差。</p><h3 id="_1-28为什么kafka的复制至关重要" tabindex="-1"><a class="header-anchor" href="#_1-28为什么kafka的复制至关重要" aria-hidden="true">#</a> 1.28为什么Kafka的复制至关重要？</h3><p>由于复制，我们可以确保发布的消息不会丢失，并且可以在发生任何机器错误、程序错误或频繁的软件升级时使用。</p><h3 id="_1-29什么是kafka中的地域复制" tabindex="-1"><a class="header-anchor" href="#_1-29什么是kafka中的地域复制" aria-hidden="true">#</a> 1.29什么是Kafka中的地域复制？</h3><p>对于我们的集群，Kafka MirrorMaker提供地理复制。基本上，消息是通过MirrorMaker跨多个数据中心或云区域复制的。因此，它可以在主动/被动场景中用于备份和恢复；也可以将数据放在离用户更近的位置，或者支持数据位置要求。</p><h3 id="_1-30什么是多租户" tabindex="-1"><a class="header-anchor" href="#_1-30什么是多租户" aria-hidden="true">#</a> 1.30什么是多租户？</h3><p>我们可以轻松地将Kafka部署为多租户解决方案。但是，通过配置主题可以生成或使用数据，可以启用多租户。此外，它还为配额提供操作支持。</p><h3 id="_1-31什么情况下一个-broker-会从isr中踢出去" tabindex="-1"><a class="header-anchor" href="#_1-31什么情况下一个-broker-会从isr中踢出去" aria-hidden="true">#</a> 1.31什么情况下一个 Broker 会从ISR中踢出去?</h3><p>leader 会维护一个与其基本保持同步的 Replica 列表，该列表称为 ISR(in-sync Replica)，每个 Partition 都会有一个 ISR，而且是由 leader 动态维护 ，如果一个 follower 比一个 leader 落后太多，或者超过一定时间未发起数据复制请求，则 leader 将其重 ISR 中移除 。</p><h3 id="_1-32如果-leader-crash-时-isr为空怎么办" tabindex="-1"><a class="header-anchor" href="#_1-32如果-leader-crash-时-isr为空怎么办" aria-hidden="true">#</a> 1.32如果 Leader Crash 时，ISR为空怎么办</h3><p>kafka在Broker端提供了一个配置参数：unclean.leader.election,这个参数有两个值：</p><ul><li><strong>true</strong>（默认）： 允许不同步副本成为leader，由于不同步副本的消息较为滞后，此时成为leader，可能会出现消息不一致的情况。</li><li><strong>false</strong>： 不允许不同步副本成为leader，此时如果发生ISR列表为空，会一直等待旧leader恢复，降低了可用性。</li></ul><h3 id="_1-33副本长时间不在isr中-这意味着什么" tabindex="-1"><a class="header-anchor" href="#_1-33副本长时间不在isr中-这意味着什么" aria-hidden="true">#</a> 1.33副本长时间不在ISR中，这意味着什么？</h3><p>意味着 follower 不能像 leader 收集数据那样快速地获取数据。</p><h3 id="_1-34kafka-producer如何优化写入速度" tabindex="-1"><a class="header-anchor" href="#_1-34kafka-producer如何优化写入速度" aria-hidden="true">#</a> 1.34Kafka Producer如何优化写入速度?</h3><ul><li>增加线程</li><li>提高 batch.size</li><li>增加更多 producer 实例</li><li>增加 partition 数</li><li>设置 acks=-1 时，如果延迟增大：可以增大 num.replica.fetchers（follower 同步数据的线程数）来调解；</li><li>跨数据中心的传输：增加 socket 缓冲区设置以及 OS tcp 缓冲区设置。</li></ul><h3 id="_1-35kafka-producer-api的作用是什么" tabindex="-1"><a class="header-anchor" href="#_1-35kafka-producer-api的作用是什么" aria-hidden="true">#</a> 1.35Kafka Producer API的作用是什么？</h3><p>允许应用程序将记录流发布到一个或多个Kafka主题的API就是我们所说的Producer API。</p><h3 id="_1-36生产者中-什么情况下会发生-queuefullexception" tabindex="-1"><a class="header-anchor" href="#_1-36生产者中-什么情况下会发生-queuefullexception" aria-hidden="true">#</a> 1.36生产者中，什么情况下会发生 QueueFullException？</h3><p>每当Kafka生产者试图以代理的身份在当时无法处理的速度发送消息时，通常都会发生QueueFullException。但是，为了协作处理增加的负载，用户需要添加足够的代理，因为生产者不会阻止。</p><h3 id="_1-37kafka-producer-写数据-ack-为-0-1-1-时分别代表什么" tabindex="-1"><a class="header-anchor" href="#_1-37kafka-producer-写数据-ack-为-0-1-1-时分别代表什么" aria-hidden="true">#</a> 1.37Kafka Producer 写数据，ACK 为 0，1，-1 时分别代表什么？</h3><ul><li>1（默认） 数据发送到Kafka后，经过leader成功接收消息的的确认，就算是发送成功了。在这种情况下，如果leader宕机了，则会丢失数据。</li><li>0 生产者将数据发送出去就不管了，不去等待任何返回。这种情况下数据传输效率最高，但是数据可靠性确是最低的。</li><li>-1 producer需要等待ISR中的所有follower都确认接收到数据后才算一次发送完成，可靠性最高。</li></ul><h3 id="_1-38当ack为-1时-什么情况下-leader-认为一条消息-commit了" tabindex="-1"><a class="header-anchor" href="#_1-38当ack为-1时-什么情况下-leader-认为一条消息-commit了" aria-hidden="true">#</a> 1.38当ack为-1时，什么情况下，Leader 认为一条消息 Commit了？</h3><p>当ISR中所有Replica都向Leader发送ACK时，leader才commit，这时候producer才能认为一个请求中的消息都commit了。</p><h3 id="_1-39kafka-unclean-配置代表什么-会对-spark-streaming-消费有什么影响" tabindex="-1"><a class="header-anchor" href="#_1-39kafka-unclean-配置代表什么-会对-spark-streaming-消费有什么影响" aria-hidden="true">#</a> 1.39Kafka Unclean 配置代表什么？会对 spark streaming 消费有什么影响？</h3><p>unclean.leader.election.enable 为 true 的话，意味着非 ISR 集合的 broker 也可以参与选举，这样有可能就会丢数据，spark streaming在消费过程中拿到的 end offset 会突然变小，导致 spark streaming job 挂掉。如果 unclean.leader.election.enable 参数设置为 true，就有可能发生数据丢失和数据不一致的情况，Kafka 的可靠性就会降低；而如果 unclean.leader.election.enable 参数设置为 false，Kafka 的可用性就会降低。</p><h3 id="_1-40kafka-中-consumer-group-是什么概念" tabindex="-1"><a class="header-anchor" href="#_1-40kafka-中-consumer-group-是什么概念" aria-hidden="true">#</a> 1.40Kafka 中 Consumer Group 是什么概念？</h3><p>同样是逻辑上的概念，是Kafka实现单播和广播两种消息模型的手段。同一个topic的数据，会广播给不同的group；同一个group中的worker，只有一个worker能拿到这个数据。换句话说，对于同一个topic，每个group都可以拿到同样的所有数据，但是数据进入group后只能被其中的一个worker消费。group内的worker可以使用多线程或多进程来实现，也可以将进程分散在多台机器上，worker的数量通常不超过partition的数量，且二者最好保持整数倍关系，因为Kafka在设计时假定了一个partition只能被一个worker消费（同一group内）。</p><h3 id="_1-41kafka-中的消息是否会丢失和重复消费" tabindex="-1"><a class="header-anchor" href="#_1-41kafka-中的消息是否会丢失和重复消费" aria-hidden="true">#</a> 1.41Kafka 中的消息是否会丢失和重复消费？</h3><p>要确定Kafka的消息是否丢失或重复，从两个方面分析入手：消息发送和消息消费。</p><ul><li><p>消息发送 Kafka消息发送有两种方式：<strong>同步</strong>（sync）和<strong>异步</strong>（async），默认是同步方式，可通过producer.type属性进行配置。Kafka通过配置request.required.acks属性来确认消息的生产：</p><ul><li>0 表示不进行消息接收是否成功的确认；</li><li>1 表示当Leader接收成功时确认；</li><li>-1 表示Leader和Follower都接收成功时确认；</li></ul><p>综上所述，有6种消息生产的情况，下面分情况来分析消息丢失的场景：</p><ul><li>acks=0； 不和Kafka集群进行消息接收确认，则当网络异常、缓冲区满了等情况时，消息可能丢失；</li><li>acks=1； 同步模式下，只有Leader确认接收成功后但挂掉了，副本没有同步，数据可能丢失；</li></ul></li><li><p>消息消费 Kafka消息消费有两个consumer接口，Low-level API和High-level API：</p><ul><li>Low-level API：消费者自己维护offset等值，可以实现对Kafka的完全控制；</li><li>High-level API：封装了对parition和offset的管理，使用简单； 如果使用高级接口High-level API，可能存在一个问题就是当消息消费者从集群中把消息取出来、并提交了新的消息offset值后，还没来得及消费就挂掉了，那么下次再消费时之前没消费成功的消息就“诡异”的消失了；</li></ul></li><li><p>解决办法：</p><ul><li>针对消息丢失： <strong>同步模式下</strong>，确认机制设置为-1，即让消息写入Leader和Follower之后再确认消息发送成功； <strong>异步模式下</strong>，为防止缓冲区满，可以在配置文件设置不限制阻塞超时时间，当缓冲区满时让生产者一直处于阻塞状态；</li><li>针对消息重复： 将消息的唯一标识保存到外部介质中，每次消费时判断是否处理过即可。</li></ul></li></ul><h3 id="_1-42为什么kafka不支持读写分离" tabindex="-1"><a class="header-anchor" href="#_1-42为什么kafka不支持读写分离" aria-hidden="true">#</a> 1.42为什么Kafka不支持读写分离？</h3><p>在 Kafka 中，生产者写入消息、消费者读取消息的操作都是与 leader 副本进行交互的，从 而实现的是一种<strong>主写主读</strong>的生产消费模型。</p><p>Kafka 并不支持主写从读，因为主写从读有 2 个很明 显的缺点:</p><ul><li><strong>数据一致性问题</strong>。数据从主节点转到从节点必然会有一个延时的时间窗口，这个时间 窗口会导致主从节点之间的数据不一致。某一时刻，在主节点和从节点中 A 数据的值都为 X， 之后将主节点中 A 的值修改为 Y，那么在这个变更通知到从节点之前，应用读取从节点中的 A 数据的值并不为最新的 Y，由此便产生了数据不一致的问题。</li><li><strong>延时问题</strong>。类似 Redis 这种组件，数据从写入主节点到同步至从节点中的过程需要经 历网络→主节点内存→网络→从节点内存这几个阶段，整个过程会耗费一定的时间。而在 Kafka 中，主从同步会比 Redis 更加耗时，它需要经历网络→主节点内存→主节点磁盘→网络→从节 点内存→从节点磁盘这几个阶段。对延时敏感的应用而言，主写从读的功能并不太适用。</li></ul><h3 id="_1-43kafka-中是怎么体现消息顺序性的" tabindex="-1"><a class="header-anchor" href="#_1-43kafka-中是怎么体现消息顺序性的" aria-hidden="true">#</a> 1.43Kafka 中是怎么体现消息顺序性的？</h3><p>kafka 每个 partition 中的消息在写入时都是有序的，消费时，每个 partition 只能被每一个 group 中的一个消费者消费，保证了消费时也是有序的。 整个 topic 不保证有序。如果为了保证 topic 整个有序，那么将 partition 调整为1.</p><h3 id="_1-44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset-1" tabindex="-1"><a class="header-anchor" href="#_1-44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset-1" aria-hidden="true">#</a> 1.44消费者提交消费位移时提交的是当前消费到的最新消息的offset还是offset+1?</h3><p>offset+1</p><h3 id="_1-45kafka-如何实现延迟队列" tabindex="-1"><a class="header-anchor" href="#_1-45kafka-如何实现延迟队列" aria-hidden="true">#</a> 1.45Kafka 如何实现延迟队列?</h3><p>Kafka并没有使用JDK自带的Timer或者DelayQueue来实现延迟的功能，而是<strong>基于时间轮自定义了一个用于实现延迟功能的定时器（SystemTimer）</strong>。JDK的Timer和DelayQueue插入和删除操作的平均时间复杂度为O(nlog(n))，并不能满足Kafka的高性能要求，而基于时间轮可以将插入和删除操作的时间复杂度都降为<strong>O(1)</strong>。时间轮的应用并非Kafka独有，其应用场景还有很多，在Netty、Akka、Quartz、Zookeeper等组件中都存在时间轮的踪影。</p><p>底层使用数组实现，数组中的每个元素可以存放一个TimerTaskList对象。TimerTaskList是一个环形双向链表，在其中的链表项TimerTaskEntry中封装了真正的定时任务TimerTask.</p><p>Kafka中到底是怎么推进时间的呢？Kafka中的定时器借助了JDK中的DelayQueue来协助推进时间轮。具体做法是对于每个使用到的TimerTaskList都会加入到DelayQueue中。<strong>Kafka中的TimingWheel专门用来执行插入和删除TimerTaskEntry的操作，而DelayQueue专门负责时间推进的任务</strong>。再试想一下，DelayQueue中的第一个超时任务列表的expiration为200ms，第二个超时任务为840ms，这里获取DelayQueue的队头只需要O(1)的时间复杂度。如果采用每秒定时推进，那么获取到第一个超时的任务列表时执行的200次推进中有199次属于“空推进”，而获取到第二个超时任务时有需要执行639次“空推进”，这样会无故空耗机器的性能资源，这里采用DelayQueue来辅助以少量空间换时间，从而做到了“精准推进”。Kafka中的定时器真可谓是“知人善用”，用TimingWheel做最擅长的任务添加和删除操作，而用DelayQueue做最擅长的时间推进工作，相辅相成。</p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><!----></div><div class="meta-item contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: 498420540@qq.com">yue</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/interview/MIDDLEWARE/RocketMQ.html" class="nav-link prev" aria-label="RocketMQ"><div class="hint"><span class="arrow left"></span>上一页</div><div class="link"><!---->RocketMQ</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">Default footer</div><div class="copyright">Copyright © 2022 Mr.yue</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.c4e9f175.js" defer></script>
  </body>
</html>
